<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="theme-color" content="#3F51B5">

    <title>ROS Data Waster</title>
    <meta name="description" content="The most straightforward way to waste all of your data.">

    <link rel="shortcut icon" href="favicon.ico">

    <link rel="stylesheet" href="https://unpkg.com/material-components-web@0.42.1/dist/material-components-web.min.css">

    <style>
        :root {
            --mdc-theme-primary: #3f51b5;
            --mdc-theme-secondary: #f44336;
            --mdc-theme-on-primary: #ffffff;
            --mdc-theme-on-secondary: #ffffff;
        }

        :root body {
            background-color: #3f51b5;
        }

        :root body main {
            background-color: #ffffff;
            border-radius: 4px;
            margin: 20px;
            min-width: calc(100vw - 80px);
            min-height: calc(100vh - 80px);
            padding: 20px;
        }

        .mdc-text-field {
            width: 100%;
        }

        body > main > label {
            padding-left: 8px;
        }
    </style>

    <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Roboto:300,400,500'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" />

</head>

<body>

    <main class="mdc-typography">
        <h1 class="mdc-typography--headline1">ROS Data Waster</h1>
        <p class="mdc-typography--body1">The most straightforward way to waste all of your data.</p>
        <div class="mdc-switch mdc-switch--checked" data-mdc-auto-init="MDCSwitch">
            <div class="mdc-switch__track"></div>
            <div class="mdc-switch__thumb-underlay">
                <div class="mdc-switch__thumb">
                    <input type="checkbox" id="basic-switch" class="mdc-switch__native-control" role="switch" checked>
                </div>
            </div>
        </div>
        <label for="basic-switch">Waste Unlimited Data</label>
        <br>
        <br>
        <div class="mdc-text-field mdc-text-field--outlined mdc-text-field--disabled" data-mdc-auto-init="MDCTextField">
            <input type="number" min="1" id="goal" value="1" class="mdc-text-field__input">
            <div class="mdc-notched-outline">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                    <label for="goal" class="mdc-floating-label">MBs of data to waste</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
            </div>
        </div>
        <br>
        <br>
        <button id="btn" class="mdc-button mdc-button--outlined" data-mdc-auto-init="MDCRipple">Start Wasting</button>
        <br>
        <br>
        <div role="progressbar" class="mdc-linear-progress mdc-linear-progress--indeterminate mdc-linear-progress--closed">
            <div class="mdc-linear-progress__buffering-dots"></div>
            <div class="mdc-linear-progress__buffer"></div>
            <div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar">
                <span class="mdc-linear-progress__bar-inner"></span>
            </div>
            <div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar">
                <span class="mdc-linear-progress__bar-inner"></span>
            </div>
        </div>
        <p class="mdc-typography--body1">
            Megabytes wasted: <span id="byte">0</span>
        </p>
        <p class="mdc-typography--body1">
            Megabytes wasted per second: <span id="speed">0</span>
        </p>

        <div class="mdc-snackbar mdc-snackbar--align-start" aria-live="assertive" aria-atomic="true" aria-hidden="true">
            <div class="mdc-snackbar__text"></div>
            <div class="mdc-snackbar__action-wrapper">
                <button type="button" class="mdc-snackbar__action-button"></button>
            </div>
        </div>
    </main>

    <script async src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
    <script src="https://unpkg.com/material-components-web@0.42.1/dist/material-components-web.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <script>
        'use strict';

        window.mdc.autoInit();

        var snackbar = new mdc.snackbar.MDCSnackbar(document.querySelector('.mdc-snackbar'));
        var progressbar = new mdc.linearProgress.MDCLinearProgress(document.querySelector('.mdc-linear-progress'));

        var running = false;
        var wasted = 0;
        var xhr = [];
        var threads = 8;
        var time = 0;
        var goal = 0;
        var chunk = 800000;
        var v = 2;
        var int = null;
        var stopped = false;

        var speed = 0;
        var url = "";

        var getmbs = function getmbs() {
            if (document.querySelector('.mdc-switch').MDCSwitch.checked === true) {
                return 0;
            }
            return parseInt($("#goal").val());
        };

        var download = function download(id) {
            if (xhr[id] && xhr[id].status == 200) {
                wasted += chunk;
                $('#byte').html((0 | wasted * 100 / 1048576) / 100);
                speed = wasted / (new Date().getTime() - time) * 1000;
                speed = (0 | speed * 100 / 1048576) / 100;
                $('#speed').html(speed);
                if (getmbs() !== 0) {
                    if (parseInt($("#byte").html()) / parseInt($("#goal").val()) < 1.0) {
                        progressbar.progress = parseInt($("#byte").html()) / parseInt($("#goal").val());
                    } else {
                        progressbar.progress = 1.0;
                    }
                }
                if (wasted >= 1048576 * 1024 * 100) {
                    snackbar.show({
                        message: "Data wasted reached internal limit."
                    });
                    stop();
                }
                if (goal !== 0 && wasted >= goal * 1048576) {
                    snackbar.show({
                        message: "The specified amount of data was wasted."
                    });
                    stop();
                }
            }
            if (running == true) {
                url = "https://ros-static.ga/public/ros-data-waster-dummy" + '?' + Math.random();
                xhr[id] = $.ajax({
                    url: url,
                    complete: function complete(data) {
                        download(id);
                    }
                });
            }
        };

        var stop = function stop() {
            running = false;
            document.querySelector('.mdc-text-field').MDCTextField.disabled = document.querySelector('.mdc-switch').MDCSwitch.checked;
            document.querySelector('.mdc-switch').MDCSwitch.disabled = false;
            progressbar.close();
            $('#btn').html('Start Wasting');
        };

        var start = function start() {
            document.querySelector('.mdc-text-field').MDCTextField.disabled = true;
            document.querySelector('.mdc-switch').MDCSwitch.disabled = true;
            progressbar.determinate = getmbs() !== 0;
            progressbar.open();
            $('#btn').html('Stop Wasting');
            running = true;
            wasted = 0;
            xhr = [];
            time = new Date().getTime();
            goal = getmbs();
            for (var i = 0; i < threads; i++) {
                download(i);
            }
        };

        $('input').on('input', function() {
            $("#btnSubmit").attr("disabled", true);
            $("#btn").attr("disabled", !document.querySelector("input").validity.valid);
        });

        $('#basic-switch').on('click', function() {
            document.querySelector('.mdc-text-field').MDCTextField.disabled = document.querySelector('.mdc-switch').MDCSwitch.checked;
            document.querySelector('.mdc-text-field').MDCTextField.required = !document.querySelector('.mdc-switch').MDCSwitch.checked;
            if (document.querySelector('.mdc-switch').MDCSwitch.checked) {
                progressbar.determinate = false;
            } else {
                progressbar.determinate = true;
            }
        });

        $('#btn').on('click', function() {
            if (running == false && stopped == false) {
                start();
            } else if (stopped == false) {
                stop();
            }
        });
    </script>

</body>

</html>
